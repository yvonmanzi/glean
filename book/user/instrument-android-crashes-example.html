<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Instrumenting Android Crashes With Glean - Glean - Cross-platform Telemetry library</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../glean.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Glean</a></li><li class="expanded "><a href="../user/index.html"><strong aria-hidden="true">2.</strong> Using the Glean SDK</a></li><li><ol class="section"><li class="expanded "><a href="../user/adding-glean-to-your-project.html"><strong aria-hidden="true">2.1.</strong> Adding Glean to your project</a></li><li class="expanded "><a href="../user/general-api.html"><strong aria-hidden="true">2.2.</strong> The General API</a></li><li class="expanded "><a href="../user/adding-new-metrics.html"><strong aria-hidden="true">2.3.</strong> Adding new metrics</a></li><li class="expanded "><a href="../user/metric-parameters.html"><strong aria-hidden="true">2.4.</strong> Metric parameters</a></li><li class="expanded "><a href="../user/testing-metrics.html"><strong aria-hidden="true">2.5.</strong> Testing metrics</a></li><li class="expanded "><a href="../user/debugging/index.html"><strong aria-hidden="true">2.6.</strong> Debugging products using Glean</a></li><li><ol class="section"><li class="expanded "><a href="../user/debugging/android.html"><strong aria-hidden="true">2.6.1.</strong> Android</a></li><li class="expanded "><a href="../user/debugging/ios.html"><strong aria-hidden="true">2.6.2.</strong> iOS</a></li></ol></li><li class="expanded "><a href="../user/error-reporting.html"><strong aria-hidden="true">2.7.</strong> Error reporting</a></li><li class="expanded "><a href="../user/experiments-api.html"><strong aria-hidden="true">2.8.</strong> Using the experiments API</a></li><li class="expanded "><a href="../user/metrics/index.html"><strong aria-hidden="true">2.9.</strong> Metric types</a></li><li><ol class="section"><li class="expanded "><a href="../user/metrics/boolean.html"><strong aria-hidden="true">2.9.1.</strong> Boolean</a></li><li class="expanded "><a href="../user/metrics/counter.html"><strong aria-hidden="true">2.9.2.</strong> Counter</a></li><li class="expanded "><a href="../user/metrics/labeled_counters.html"><strong aria-hidden="true">2.9.3.</strong> Labeled Counters</a></li><li class="expanded "><a href="../user/metrics/string.html"><strong aria-hidden="true">2.9.4.</strong> String</a></li><li class="expanded "><a href="../user/metrics/labeled_strings.html"><strong aria-hidden="true">2.9.5.</strong> Labeled Strings</a></li><li class="expanded "><a href="../user/metrics/string_list.html"><strong aria-hidden="true">2.9.6.</strong> String List</a></li><li class="expanded "><a href="../user/metrics/timespan.html"><strong aria-hidden="true">2.9.7.</strong> Timespan</a></li><li class="expanded "><a href="../user/metrics/timing_distribution.html"><strong aria-hidden="true">2.9.8.</strong> Timing Distribution</a></li><li class="expanded "><a href="../user/metrics/memory_distribution.html"><strong aria-hidden="true">2.9.9.</strong> Memory Distribution</a></li><li class="expanded "><a href="../user/metrics/uuid.html"><strong aria-hidden="true">2.9.10.</strong> UUID</a></li><li class="expanded "><a href="../user/metrics/datetime.html"><strong aria-hidden="true">2.9.11.</strong> Datetime</a></li><li class="expanded "><a href="../user/metrics/event.html"><strong aria-hidden="true">2.9.12.</strong> Event</a></li><li class="expanded "><a href="../user/metrics/custom_distribution.html"><strong aria-hidden="true">2.9.13.</strong> Custom Distribution</a></li><li class="expanded "><a href="../user/metrics/quantity.html"><strong aria-hidden="true">2.9.14.</strong> Quantity</a></li></ol></li><li class="expanded "><a href="../user/pings/index.html"><strong aria-hidden="true">2.10.</strong> Pings</a></li><li><ol class="section"><li class="expanded "><a href="../user/pings/baseline.html"><strong aria-hidden="true">2.10.1.</strong> Baseline Ping</a></li><li class="expanded "><a href="../user/pings/deletion_request.html"><strong aria-hidden="true">2.10.2.</strong> Deletion Request Ping</a></li><li class="expanded "><a href="../user/pings/metrics.html"><strong aria-hidden="true">2.10.3.</strong> Metrics Ping</a></li><li class="expanded "><a href="../user/pings/events.html"><strong aria-hidden="true">2.10.4.</strong> Events Ping</a></li><li class="expanded "><a href="../user/pings/custom.html"><strong aria-hidden="true">2.10.5.</strong> Custom Pings</a></li><li class="expanded "><a href="../user/pings/testing-custom-pings.html"><strong aria-hidden="true">2.10.6.</strong> Testing custom pings</a></li></ol></li><li class="expanded "><a href="../user/android-build-configuration-options.html"><strong aria-hidden="true">2.11.</strong> Android build configuration options</a></li><li class="expanded "><a href="../user/focused-use-cases.html"><strong aria-hidden="true">2.12.</strong> Focused Use Cases</a></li><li><ol class="section"><li class="expanded "><a href="../user/instrument-android-crashes-example.html" class="active"><strong aria-hidden="true">2.12.1.</strong> Instrumenting Android Crashes With Glean</a></li></ol></li></ol></li><li class="expanded "><a href="../user/collected-metrics/metrics.html"><strong aria-hidden="true">3.</strong> Metrics collected by the Glean SDK</a></li><li class="expanded "><a href="../dev/index.html"><strong aria-hidden="true">4.</strong> Developing the Glean SDK</a></li><li><ol class="section"><li class="expanded "><a href="../dev/testing.html"><strong aria-hidden="true">4.1.</strong> Testing</a></li><li class="expanded "><a href="../dev/docs.html"><strong aria-hidden="true">4.2.</strong> Developing documentation</a></li><li class="expanded "><a href="../dev/android/index.html"><strong aria-hidden="true">4.3.</strong> Android bindings</a></li><li><ol class="section"><li class="expanded "><a href="../dev/android/setup-android-build-environment.html"><strong aria-hidden="true">4.3.1.</strong> Setup Build Environment</a></li></ol></li><li class="expanded "><a href="../dev/ios/index.html"><strong aria-hidden="true">4.4.</strong> iOS bindings</a></li><li><ol class="section"><li class="expanded "><a href="../dev/ios/setup-ios-build-environment.html"><strong aria-hidden="true">4.4.1.</strong> Setup Build Environment</a></li><li class="expanded "><a href="../dev/ios/debug-glean-on-ios.html"><strong aria-hidden="true">4.4.2.</strong> Debugging Different Versions of Glean</a></li></ol></li><li class="expanded "><a href="../dev/python/index.html"><strong aria-hidden="true">4.5.</strong> Python bindings</a></li><li><ol class="section"><li class="expanded "><a href="../dev/python/setting-up-python-build-environment.html"><strong aria-hidden="true">4.5.1.</strong> Setup Build Environment</a></li></ol></li><li class="expanded "><a href="../dev/core/index.html"><strong aria-hidden="true">4.6.</strong> Rust Component</a></li><li><ol class="section"><li class="expanded "><a href="../dev/core/dependency-management.html"><strong aria-hidden="true">4.6.1.</strong> Dependency Management</a></li><li class="expanded "><a href="../dev/core/new-metric-type.html"><strong aria-hidden="true">4.6.2.</strong> Adding a new metric type</a></li><li><ol class="section"><li class="expanded "><a href="../dev/core/new-metric-type/ffi.html"><strong aria-hidden="true">4.6.2.1.</strong> FFI</a></li><li class="expanded "><a href="../dev/core/new-metric-type/kotlin.html"><strong aria-hidden="true">4.6.2.2.</strong> Kotlin</a></li><li class="expanded "><a href="../dev/core/new-metric-type/swift.html"><strong aria-hidden="true">4.6.2.3.</strong> Swift</a></li><li class="expanded "><a href="../dev/core/new-metric-type/python.html"><strong aria-hidden="true">4.6.2.4.</strong> Python</a></li></ol></li></ol></li><li class="expanded "><a href="../dev/ffi/index.html"><strong aria-hidden="true">4.7.</strong> FFI Layer</a></li><li><ol class="section"><li class="expanded "><a href="../dev/ffi/when-to-use-what-in-the-ffi.html"><strong aria-hidden="true">4.7.1.</strong> When/How FFI</a></li></ol></li><li class="expanded "><a href="../contributing.html"><strong aria-hidden="true">4.8.</strong> Contributing</a></li><li><ol class="section"><li class="expanded "><a href="../code_coverage.html"><strong aria-hidden="true">4.8.1.</strong> Code coverage</a></li></ol></li><li class="expanded "><a href="../dev/cut-a-new-release.html"><strong aria-hidden="true">4.9.</strong> Release process</a></li><li class="expanded "><a href="../dev/core/internal/index.html"><strong aria-hidden="true">4.10.</strong> Internal implementation details</a></li><li><ol class="section"><li class="expanded "><a href="../dev/core/internal/reserved-ping-names.html"><strong aria-hidden="true">4.10.1.</strong> Reserved ping names</a></li><li class="expanded "><a href="../dev/core/internal/clearing.html"><strong aria-hidden="true">4.10.2.</strong> Clearing metrics when disabling/enabling Glean</a></li><li class="expanded "><a href="../dev/core/internal/payload.html"><strong aria-hidden="true">4.10.3.</strong> Payload format</a></li><li class="expanded "><a href="../dev/core/internal/directory-structure.html"><strong aria-hidden="true">4.10.4.</strong> Directory structure</a></li><li class="expanded "><a href="../dev/core/internal/debug-pings.html"><strong aria-hidden="true">4.10.5.</strong> Debug Pings</a></li></ol></li><li class="expanded "><a href="../dev/howtos/index.html"><strong aria-hidden="true">4.11.</strong> Howtos</a></li><li><ol class="section"><li class="expanded "><a href="../dev/howtos/development-with-android-components.html"><strong aria-hidden="true">4.11.1.</strong> Development with android-components</a></li><li class="expanded "><a href="../dev/howtos/locally-published-components-in-fenix.html"><strong aria-hidden="true">4.11.2.</strong> Locally-published components in Fenix</a></li></ol></li></ol></li><li class="expanded "><a href="../api/index.html"><strong aria-hidden="true">5.</strong> API Documentation</a></li><li class="expanded "><a href="../appendix/index.html"><strong aria-hidden="true">6.</strong> Appendix</a></li><li><ol class="section"><li class="expanded "><a href="../appendix/glossary.html"><strong aria-hidden="true">6.1.</strong> Glossary</a></li><li class="expanded "><a href="../appendix/changelog.html"><strong aria-hidden="true">6.2.</strong> Changelog</a></li><li class="expanded "><a href="../appendix/twig.html"><strong aria-hidden="true">6.3.</strong> This Week in Glean</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Glean - Cross-platform Telemetry library</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                            <a href="https://github.com/mozilla/glean" title="Git repository" aria-label="Git repository">
                                <i id="git-repository-button" class="fa fa-github"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#instrumenting-android-crashes-with-the-glean-sdk" id="instrumenting-android-crashes-with-the-glean-sdk">Instrumenting Android Crashes With The Glean SDK</a></h1>
<p>One of the things that might be useful to collect data on in an Android application is crashes.  This guide will walk through a
basic strategy for instrumenting an Android application with crash telemetry using a custom ping.</p>
<p><strong>Note:</strong>  This is a <em>very</em> simple example of instrumenting crashes using the Glean SDK.  There will be challenges to
using this approach in a production application that should be considered.  For instance, when an app crashes it can be in an
unknown state and may not be able to do things like upload data to a server.  The recommended way of instrumenting crashes with
Android Components is called <a href="https://github.com/mozilla-mobile/android-components/tree/master/components/lib/crash">lib-crash</a>, which takes into consideration things like multiple processes and persistence.</p>
<h2><a class="header" href="#before-you-start" id="before-you-start">Before You Start</a></h2>
<p>There are a few things that need to be installed in order to proceed, mainly <a href="https://developer.android.com/studio/">Android Studio</a>.  If you include the Android SDK,
Android Studio can take a little while to download and get installed.  This walk-through assumes some knowledge of Android
application development.  Knowing where to go to create a new project and how to add dependencies to a Gradle file will be
helpful in following this guide.</p>
<h2><a class="header" href="#setup-build-configuration" id="setup-build-configuration">Setup Build Configuration</a></h2>
<p>Please follow the instruction in the <a href="adding-glean-to-your-project.html">&quot;Adding Glean to your project&quot;</a> chapter in order to set up
Glean in an Android project.</p>
<h3><a class="header" href="#add-a-custom-metric" id="add-a-custom-metric">Add A Custom Metric</a></h3>
<p>Since crashes will be instrumented with some custom metrics, the next step will be to add a <code>metrics.yaml</code> file to define the
metrics used to record the crash information and a <code>pings.yaml</code> file to define a custom ping which will give some control over
the scheduling of the uploading.  See <a href="adding-new-metrics.html">&quot;Adding new metrics&quot;</a> for more information about adding metrics.</p>
<p>What metric type should be used to represent the crash data?  While this could be implemented several ways, an <a href="metrics/event.html">event</a> is an
excellent choice, simply because events capture information in a nice concise way and they have a built-in way of passing
additional information using the <code>extras</code> field.  If it is necessary to pass along the cause of the exception or a few lines of
description, events let us do that easily (with <a href="metrics/event.html#limits">some limitations</a>).</p>
<p>Now that a metric type has been chosen to represent the metric, the next step is creating the <code>metrics.yaml</code>.  Inside of the
root application folder of the Android Studio project create a new file named <code>metrics.yaml</code>.  After adding the schema
definition and event metric definition, the <code>metrics.yaml</code> should look like this:</p>
<pre><code class="language-YAML"># Required to indicate this is a `metrics.yaml` file
$schema: moz://mozilla.org/schemas/glean/metrics/1-0-0

crash:
  exception:
    type: event
    description: |
      Event to record crashes caused by unhandled exceptions
    notification_emails:
      - crashes@example.com
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
    data_reviews:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
    expires:
      2021-01-01
    send_in_pings:
      - crash
    extra_keys:
      cause:
        description: The cause of the crash
      message:
        description: The exception message
</code></pre>
<p>As a brief explanation, this creates a metric called <code>exception</code> within a metric category called <code>crash</code>.  There is a text
<code>description</code> and the required <code>notification_emails</code>, <code>bugs</code>, <code>data_reviews</code>, and <code>expires</code> fields.  The <code>send_in_pings</code> field
is important to note here that it has a value of <code>- crash</code>.  This means that the crash event metric will be sent via a custom
ping named <code>crash</code> (which hasn't been created yet).  Finally, note the <code>extra_keys</code> field which has two keys defined, <code>cause</code>
and <code>message</code>.  This allows for sending additional information along with the event to be associated with these keys.</p>
<p><strong>Note:</strong>  For Mozilla applications, a mandatory <a href="https://github.com/mozilla/data-review/blob/master/request.md">data review</a> is required in order to collect information with the Glean SDK.</p>
<h3><a class="header" href="#add-a-custom-ping" id="add-a-custom-ping">Add A Custom Ping</a></h3>
<p>Define the custom ping that will help control the upload scheduling by creating a <code>pings.yaml</code> file in the same directory as
the <code>metrics.yaml</code> file.  For more information about adding custom pings, see the section on <a href="pings/custom.html">custom pings</a>.<br />
The name of the ping will be <code>crash</code>, so the <code>pings.yaml</code> file should look like this:</p>
<pre><code class="language-YAML"># Required to indicate this is a `pings.yaml` file
$schema: moz://mozilla.org/schemas/glean/pings/1-0-0

crash:
  description: &gt;
    A ping to transport crash data
  include_client_id: true
  notification_emails:
    - crash@example.com
  bugs:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
  data_reviews:
    - https://bugzilla.mozilla.org/show_bug.cgi?id=1582479
</code></pre>
<p>Before the newly defined metric or ping can be used, the application must first be built.  This will cause the <a href="https://github.com/mozilla/glean_parser/">glean_parser</a>
to execute and generate the API files that represent the metric and ping that were newly defined.</p>
<p><strong>Note:</strong> If changes to the YAML files aren't showing up in the project, try running the clean task on the project before
building any time one of the Glean YAML files has been modified.</p>
<p>It is recommended that Glean be initialized as early in the application startup as possible, which is why it's good to use a
custom <code>Application</code>, like the Glean Sample App <a href="https://github.com/mozilla/glean/blob/master/samples/android/app/src/main/java/org/mozilla/samples/glean/GleanApplication.kt"><code>GleanApplication.kt</code></a>.</p>
<p>Initializing Glean in the <code>Application.onCreate()</code> is ideal for this purpose.  Start by adding the import statement to allow
the usage of the custom ping that was created, adding the following to the top of the file:</p>
<pre><code class="language-Kotlin">import org.mozilla.gleancrashexample.GleanMetrics.Pings
</code></pre>
<p>Next, register the custom ping by calling <code>Glean.registerPings(Pings)</code> in the <code>onCreate()</code> function, preferably before calling
<code>Glean.initialize()</code>.  The completed function should look something like this:</p>
<pre><code class="language-Kotlin">override fun onCreate() {
  super.onCreate()

  // Register the application's custom pings.
  Glean.registerPings(Pings)

  // Initialize the Glean library
  Glean.initialize(applicationContext)
}

</code></pre>
<p>This completes the registration of the custom ping with the Glean SDK so that it knows about it and can manage the storage and
other important details of it like sending it when <code>send()</code> is called.</p>
<h3><a class="header" href="#instrument-the-app-to-record-the-event" id="instrument-the-app-to-record-the-event">Instrument The App To Record The Event</a></h3>
<p>In order to make the custom <code>Application</code> class handle uncaught exceptions, extend the class definition by adding
<code>Thread.UncaughtExceptionHandler</code> as an inherited class like this:</p>
<pre><code class="language-Kotlin">class MainActivity : AppCompatActivity(), Thread.UncaughtExceptionHandler {
    ...
}
</code></pre>
<p>As part of implementing the <code>Thread.UncaughtExceptionHandler</code> interface, the custom <code>Application</code> needs to implement the
override of the <code>uncaughtException()</code> function.  An example of this override that records data and sends the ping could look
something like this:</p>
<pre><code class="language-Kotlin">override fun uncaughtException(thread: Thread, exception: Throwable) {
    Crash.exception.record(
        mapOf(
            Crash.exceptionKeys.cause to exception.cause!!.toString(),
            Crash.exceptionKeys.message to exception.message!!
        )
    )
    Pings.crash.submit()
}
</code></pre>
<p>This records data to the <code>Crash.exception</code> metric from the <code>metrics.yaml</code>.  The category of the metric is <code>crash</code> and the name
is <code>exception</code> so it is accessed it by calling <code>record()</code> on the <code>Crash.exception</code> object.  The extra information for the
<code>cause</code> and the <code>message</code> is set as well.  Finally, calling <code>Pings.crash.submit()</code> forces the <code>crash</code> ping to be scheduled to be
sent.</p>
<p>The final step is to register the custom <code>Application</code> as the default uncaught exception handler by adding the following to the
<code>onCreate()</code> function after <code>Glean.initialize(this)</code>:</p>
<pre><code class="language-Kotlin">Thread.setDefaultUncaughtExceptionHandler(this)
</code></pre>
<h3><a class="header" href="#next-steps" id="next-steps">Next Steps</a></h3>
<p>This information didn't really get recorded by anything, as it would be rejected by the telemetry pipeline unless the
application was already known.  In order to collect telemetry from a new application, there is additional work that is
necessary that is beyond the scope of this example.  In order for data to be collected from your project, metadata must be
added to the <code>probe_scraper</code>.  The instructions for accomplishing this can be found in the <a href="https://github.com/mozilla/probe-scraper#adding-a-new-glean-repository"><code>probe_scraper</code> documentation</a>.</p>
<footer id="open-on-gh">Found a bug? <a href="https://github.com/mozilla/glean/edit/master/docs/user/instrument-android-crashes-example.md">Edit this file on GitHub.</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../user/focused-use-cases.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../user/collected-metrics/metrics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../user/focused-use-cases.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../user/collected-metrics/metrics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../tabs.js"></script>
        

        

    </body>
</html>
